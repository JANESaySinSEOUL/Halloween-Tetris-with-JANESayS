<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"> <!-- 'ê¸°ê¹”ë‚˜ëŠ”' ëª¨ë°”ì¼ í™•ëŒ€ ë°©ì§€! -->
    <title>Halloween Specter Tetris</title>
    <!-- Tailwind CSS ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- â˜…â˜…â˜… NEW: 'ê¸°ê¹”ë‚˜ëŠ”' GenZ í°íŠ¸ 'Gaegu' (ê°œêµ¬) 'ê°€ì¦ˆì•„!' â˜…â˜…â˜… -->
    <link href="https://fonts.googleapis.com/css2?family=Griffy&family=Gaegu:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            /* â˜…â˜…â˜… NEW: 'ê¸°ê¹”ë‚˜ëŠ”' GenZ í•œê¸€ í°íŠ¸ ì ìš©! â˜…â˜…â˜… */
            font-family: 'Gaegu', cursive; 
            overflow: hidden; /* ìŠ¤í¬ë¡¤ ë°©ì§€ */
            background: linear-gradient(180deg, #0d0a1a 0%, #310b4a 100%); /* ì–´ë‘¡ê³  ë³´ë¼ìƒ‰ì¸ ë°°ê²½ */
            touch-action: none; /* 'ê¸°ê¹”ë‚˜ëŠ”' ëª¨ë°”ì¼ í„°ì¹˜ ìŠ¤í¬ë¡¤ 'ê¸°ê¹”ë‚˜ê²Œ' ì‹¹! ë°©ì§€ */
        }
        /* 'ê¸°ê¹”ë‚˜ëŠ”' ì˜ì–´ ì œëª© í°íŠ¸ (Griffy) */
        .title-font {
            font-family: 'Griffy', cursive;
        }
        canvas {
            background-color: #1a1a1a;
            display: block;
            border: 4px dashed #ff6600; /* í• ë¡œìœˆ ì£¼í™©ìƒ‰ ì ì„  */
            box-shadow: 0 0 25px #ff6600, inset 0 0 10px #000;
            margin: 0 auto; /* 'ê¸°ê¹”ë‚˜ëŠ”' ì¤‘ì•™ ì •ë ¬ 'ê°€ì¦ˆì•„!' */
        }
        .hidden { display: none; }
        /* ì¼ë°˜ í…ìŠ¤íŠ¸ìš© í°íŠ¸ (ê°€ë…ì„±) */
        .normal-text {
            font-family: 'Inter', sans-serif; /* Tailwind ê¸°ë³¸ í°íŠ¸ */
        }
    </style>
</head>
<body class="text-white min-h-screen flex flex-col items-center justify-center p-4">

    <!-- 'ê¸°ê¹”ë‚˜ëŠ”' ìŒì†Œê±° ë²„íŠ¼! -->
    <button id="muteButton" class="absolute top-4 right-4 text-3xl opacity-80 hover:opacity-100 z-10">ğŸ”Š</button>

    <div class="w-full max-w-sm text-center">
        <h1 class="text-5xl font-bold text-orange-500 mb-2 title-font">Halloween Specters</h1>
        
        <!-- â˜…â˜…â˜… NEW: 'ê¸°ê¹”ë‚˜ëŠ”' 'ê°€ì§œ' ë¼ì´ë¸Œ í†µê³„ 'ê°€ì¦ˆì•„!' â˜…â˜…â˜… -->
        <div class="flex justify-between text-lg mb-2 text-purple-300">
            <span>ì°¸ì—¬: <span id="participants">1337</span>ëª…</span>
            <span>í‰ê·  ì ìˆ˜: <span id="avgScore">4500</span>ì </span>
        </div>

        <div class="flex justify-between text-3xl mb-2 text-lime-400">
            <span>Score: <span id="score">0</span></span>
            <span>Level: <span id="level">1</span></span>
        </div>

        <!-- ê²Œì„ ìº”ë²„ìŠ¤ (ì´ì œ 'ê¸°ê¹”ë‚˜ê²Œ' ì¤‘ì•™ ì •ë ¬!) -->
        <canvas id="gameCanvas" width="300" height="600" class="rounded-lg"></canvas>

        <!-- 'ê¸°ê¹”ë‚˜ëŠ”' ë¶€ì œ (GenZ í°íŠ¸ ì ìš©!) -->
        <p class="text-2xl text-purple-300 mt-4">Moonlight Specters, ë³´ë¦„ë‹¬ì´ ëœ¨ë©´ ê·¸ë“¤ì´ ì˜¨ë‹¤! ğŸŒ•</p>
        <p class="text-2xl text-purple-300 mt-1">ë„ì „í•´ë³¼ë˜?</p> 

        <div class="mt-4 text-lime-400 text-xl">
            Created by <a href="https://www.youtube.com/@JanesaysPalalalaRecords" target="_blank" class="hover:text-orange-500 underline title-font">JANESayS</a>
            <p class="text-sm normal-text text-gray-400">(Click to listen to the original soundtrack!)</p>
        </div>

        <!-- â˜…â˜…â˜… NEW: 'ê¸°ê¹”ë‚˜ëŠ”' 'ë©˜íƒˆ íšŒë³µ' GameOver 'ê°€ì¦ˆì•„!' â˜…â˜…â˜… -->
        <div id="game-over" class="hidden absolute inset-0 bg-black bg-opacity-80 flex flex-col justify-center items-center text-center p-4">
            <h2 class="text-7xl font-bold text-red-600">ë‹¤ì‹œ ë„ì „! ğŸ”¥</h2>
            <p class="text-5xl text-white mt-2">í•  ìˆ˜ ìˆì–´ìš”!</p>
            
            <p class="text-4xl mt-4 text-lime-400">Score: <span id="finalScore">0</span></p>
    
            <div class="mt-6 text-3xl text-white normal-text px-4">
                <p>"Moonlight SpectersëŠ” ì´ 30 Levelê¹Œì§€!"</p>
                <p class="text-2xl text-gray-300 mt-2">"'ìŠ¤ì¼ˆë ˆíƒˆ ì„¸ë ˆë‚˜ë°' ë“¤ìœ¼ë©´ì„œ<br>ë©˜íƒˆíšŒë³µí•˜ê³  ë‹¤ì‹œ?!"</p>
            </div>
            
            <button id="restartButton" class="mt-8 px-10 py-4 bg-orange-500 text-gray-900 font-bold rounded-lg shadow-lg hover:bg-orange-400 transition-all text-5xl title-font">
                RESTART!
            </button>
        </div>

        <!-- â˜…â˜…â˜… NEW: 'ê¸°ê¹”ë‚˜ëŠ”' 1,000ì› 'í˜ì´íŒ”' 'ì–‘ì‹¬ í˜ì´ì›”' 'ê°€ì¦ˆì•„!' â˜…â˜…â˜… -->
        <div id="level-10-paywall" class="hidden absolute inset-0 bg-black bg-opacity-80 flex flex-col justify-center items-center text-center p-4">
            <div class="text-8xl mb-4">ğŸš€</div>
            <h2 class="text-4xl font-bold text-lime-400">"í…ŒíŠ¸ë¦¬ìŠ¤ êº ë¶€ì‹œê¸°?"</h2>
            <p class="text-3xl mt-2 text-white">"êµ­ë¯¼ê³ ìˆ˜ ë‹¤ ë†”ì™€ì„œ ì‹¤ë ¥ì„ ë³´ì—¬ì£¼ì„¸ìš”!"</p>
            
            <p class="text-2xl mt-6 text-purple-300 normal-text">Level 10ì€ 'ê¸°ê¹”ë‚˜ëŠ”' ì§€ì˜¥ì˜ ì‹œì‘...<br>Level 30ê¹Œì§€ 'ê°€ì¦ˆì•„!'</p>
            <p class="text-xl mt-4 text-white normal-text">"í˜„ì¬ ë‹¹ì‹ ì˜ Score/Rankingì„ ì‚´í´ë³´ì„¸ìš”! ğŸ˜‰"</p>

            <div class="mt-8">
                <a href="https://paypal.me/palalalarecordsJANE" target="_blank" class="px-6 py-4 bg-blue-500 text-white font-bold rounded-lg shadow-lg hover:bg-blue-400 transition-all text-3xl">
                    Would You Buy Me a Coffee? â˜•<br>
                    <span class="text-2xl">(JANESAYS 1,000ì› 'Paypal' í›„ì› 'ê°€ì¦ˆì•„!')</span>
                </a>
            </div>
            
            <button id="continueButton" class="mt-6 px-8 py-3 bg-gray-600 text-white font-bold rounded-lg hover:bg-gray-500 transition-all text-2xl normal-text">
                ...ë‹¤ìŒì— (ê·¸ëƒ¥ ê³„ì†í•˜ê¸°)
            </button>
        </div>


        <!-- 'ê¸°ê¹”ë‚˜ëŠ”' ë ˆë²¨ ì—… (Are You Ready?) -->
        <div id="level-up" class="hidden absolute inset-0 bg-black bg-opacity-80 flex flex-col justify-center items-center text-center p-4">
            <div class="text-8xl mb-4">ğŸ’€</div> 
            <h2 class="text-6xl font-bold text-lime-400 title-font">LEVEL <span id="nextLevel">2</span></h2>
            <p class="text-5xl mt-4 text-white">Are You Ready?</p>
        </div>

        <!-- â˜…â˜…â˜… NEW: 'ê¸°ê¹”ë‚˜ëŠ”' Level 30 'ìŠ¹ë¦¬' í™”ë©´ 'ê°€ì¦ˆì•„!' â˜…â˜…â˜… -->
        <div id="game-win" class="hidden absolute inset-0 bg-black bg-opacity-70 flex flex-col justify-center items-center text-center p-4 bg-cover bg-center" style="background-image: url('win_bg.jpg');">
            <!-- 'ê¸°ê¹”ë‚˜ëŠ”' ë°°ê²½ ì´ë¯¸ì§€ë¥¼ 'ê¸°ê¹”ë‚˜ê²Œ' ë®ëŠ” 'ê¸°ê¹”ë‚˜ëŠ”' ë°˜íˆ¬ëª… 'ê¸°ê¹”ë‚˜ëŠ”' ì˜¤ë²„ë ˆì´ -->
            <div class="absolute inset-0 bg-black bg-opacity-60 z-0"></div>
            
            <!-- 'ê¸°ê¹”ë‚˜ëŠ”' ì½˜í…ì¸  (z-10ìœ¼ë¡œ 'ê¸°ê¹”ë‚˜ê²Œ' ìœ„ë¡œ!) -->
            <div class="relative z-10 w-full">
                <h1 class="text-5xl font-bold text-orange-500 mb-2 title-font">Moonlight Specters</h1>
                
                <!-- â˜…â˜…â˜… NEW: 'ê¸°ê¹”ë‚˜ëŠ”' King/Queen 'ê°€ì¦ˆì•„!' â˜…â˜…â˜… -->
                <h2 class="text-4xl font-bold text-purple-300 mt-4 title-font">ARE YOU THE NEXT</h2>
                <h2 class="text-4xl font-bold text-purple-300 mt-1 title-font">SPECTER KING / QUEEN? ğŸ‘‘</h2>
                
                <p class="text-4xl mt-6 text-lime-400">ìµœê³  ì ìˆ˜: <span id="winScore">0</span></p>
                <p class="text-4xl mt-2 text-lime-400">Level: <span id="winLevel">0</span></p>

                <!-- 'ê¸°ê¹”ë‚˜ëŠ”' ë­í¬ (ì„ì‹œ 'ê¸°ê¹”ë‚˜ëŠ”' ì´ë¯¸ì§€!) -->
                <div class="flex justify-around w-full max-w-xs mt-6">
                    <div class="flex flex-col items-center">
                        <span class="text-6xl">ğŸ’€</span>
                        <span class="text-2xl text-white mt-2">RANK: SKELETON</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <span class="text-6xl">ğŸº</span>
                        <span class="text-2xl text-white mt-2">RANK: WOLFMAN</span>
                    </div>
                </div>

                <!-- â˜…â˜…â˜… NEW: 'ê¸°ê¹”ë‚˜ëŠ”' êµ¿ì¦ˆ 'ê°€ì¦ˆì•„!' â˜…â˜…â˜… -->
                <p class="text-xl text-gray-300 mt-6 normal-text px-2">
                    "KING / QUEENì´ ë˜ì‹  ë¶„ë“¤ì€<br>JANESAYS Pageì— Rank Pageë¥¼ í¬í•¨ì‹œì¼œ ì¶•í•˜í•´ë“œë¦¬ê³ ,<br>êµ¿ì¦ˆë„ ë³´ë‚´ë“œë¦´ ì˜ˆì •ì…ë‹ˆë‹¤!"
                </p>

                <a href="https://www.youtube.com/@JanesaysPalalalaRecords" target="_blank" class="mt-6 inline-block px-6 py-3 bg-red-600 text-white font-bold rounded-lg shadow-lg hover:bg-red-500 transition-all text-2xl normal-text">
                    BGM by JANESAYS - Click to Listen!
                </a>

                <button id="restartButtonWin" class="mt-4 block w-4/5 mx-auto px-8 py-4 bg-orange-500 text-gray-900 font-bold rounded-lg shadow-lg hover:bg-orange-400 transition-all text-3xl title-font">
                    GAME Link: Play Again!
                </button>
            </div>
        </div>
    </div>
    
    <!-- 'ê¸°ê¹”ë‚˜ëŠ”' 4ê³¡ ë¯¹ìŠ¤í…Œì 'ê°€ì¦ˆì•„!' -->
    <audio id="bgMusic" preload="auto"></audio>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // 'ê¸°ê¹”ë‚˜ëŠ”' UI ìš”ì†Œ 'ê°€ì¦ˆì•„!'
        const scoreEl = document.getElementById('score');
        const levelEl = document.getElementById('level'); 
        const gameOverEl = document.getElementById('game-over');
        const finalScoreEl = document.getElementById('finalScore');
        const restartButton = document.getElementById('restartButton');
        const levelUpEl = document.getElementById('level-up');
        const nextLevelEl = document.getElementById('nextLevel');
        const gameWinEl = document.getElementById('game-win');
        const restartButtonWin = document.getElementById('restartButtonWin');
        const winScoreEl = document.getElementById('winScore'); // 'ê¸°ê¹”ë‚˜ëŠ”' ìŠ¹ë¦¬ ì ìˆ˜
        const winLevelEl = document.getElementById('winLevel'); // 'ê¸°ê¹”ë‚˜ëŠ”' ìŠ¹ë¦¬ ë ˆë²¨
        const paywallEl = document.getElementById('level-10-paywall'); // 'ê¸°ê¹”ë‚˜ëŠ”' 1,000ì› í˜ì´ì›”
        const continueButton = document.getElementById('continueButton'); // 'ê¸°ê¹”ë‚˜ëŠ”' ê·¸ëƒ¥ ê³„ì†í•˜ê¸° ë²„íŠ¼

        // â˜…â˜…â˜… NEW: 'ê¸°ê¹”ë‚˜ëŠ”' 'ê°€ì§œ' ë¼ì´ë¸Œ í†µê³„ 'ê°€ì¦ˆì•„!' â˜…â˜…â˜…
        const participantsEl = document.getElementById('participants');
        const avgScoreEl = document.getElementById('avgScore');
        let fakeParticipants = 1337;
        let fakeAvgScore = 4500;
        // --- END NEW ---

        // 'ê¸°ê¹”ë‚˜ëŠ”' ìŒì•… ì œì–´ 'ê°€ì¦ˆì•„!'
        const muteButton = document.getElementById('muteButton');
        const bgMusic = document.getElementById('bgMusic');
        let isMuted = false;

        // 'ê¸°ê¹”ë‚˜ëŠ”' 4ê³¡ ë¯¹ìŠ¤í…Œì 'ê°€ì¦ˆì•„!'
        const playlist = [
            'song.mp3',  
            'song1.mp3', 
            'song2.mp3', 
            'song3.mp3'  
        ];
        let currentTrackIndex = 0;

        // 'ê¸°ê¹”ë‚˜ëŠ”' ê²Œì„ ë³´ë“œ 'ê°€ì¦ˆì•„!'
        const COLS = 10;
        const ROWS = 20;
        const BLOCK_SIZE = 30; 

        let board = Array.from({ length: ROWS }, () => Array(COLS).fill(0));
        let score = 0;
        let gameOver = false;
        let gamePaused = false; 
        let dropInterval = 700; 
        let level = 1; 
        let linesClearedTotal = 0; 
        let paywallShown = false; // 'ê¸°ê¹”ë‚˜ëŠ”' í˜ì´ì›” 'ê¸°ê¹”ë‚˜ê²Œ' í•œ ë²ˆë§Œ!

        // 'ê¸°ê¹”ë‚˜ëŠ”' ëª¬ìŠ¤í„° 'ê°€ì¦ˆì•„!'
        const SHAPES = [
            [[1, 1, 1, 1]], 
            [[1, 1], [1, 1]], 
            [[0, 1, 0], [1, 1, 1]], 
            [[1, 0, 0], [1, 1, 1]], 
            [[0, 0, 1], [1, 1, 1]], 
            [[1, 1, 0], [0, 1, 1]], 
            [[0, 1, 1], [1, 1, 0]]  
        ];
        const EMOJIS = ['null', 'ğŸº', 'ğŸƒ', 'ğŸ’€', 'ğŸ§œ', 'ğŸ§›', 'ğŸ§Ÿ', 'ğŸ‘»'];
        
        let currentPiece;

        class Piece {
            constructor(shape, colorIndex) {
                this.shape = shape;
                this.colorIndex = colorIndex; 
                this.x = Math.floor(COLS / 2) - Math.floor(this.shape[0].length / 2);
                this.y = 0;
            }

            draw() {
                ctx.font = `${BLOCK_SIZE * 0.9}px Arial`; 
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                const emoji = EMOJIS[this.colorIndex];

                this.shape.forEach((row, y) => {
                    row.forEach((value, x) => {
                        if (value > 0) {
                            const drawX = (this.x + x) * BLOCK_SIZE + BLOCK_SIZE / 2;
                            const drawY = (this.y + y) * BLOCK_SIZE + BLOCK_SIZE / 2;
                            ctx.fillText(emoji, drawX, drawY);
                        }
                    });
                });
            }

            move(dx, dy) {
                if (!this.isValid(this.x + dx, this.y + dy, this.shape)) {
                    if (dy === 1) { 
                        this.lock();
                        spawnNewPiece();
                    }
                    return; 
                }
                this.x += dx;
                this.y += dy;
            }

            rotate() {
                const newShape = [];
                for (let y = 0; y < this.shape[0].length; y++) {
                    newShape[y] = [];
                    for (let x = 0; x < this.shape.length; x++) {
                        newShape[y][x] = this.shape[this.shape.length - 1 - x][y];
                    }
                }

                let newX = this.x;
                if (newX < 0) newX = 0; 
                if (newX + newShape[0].length > COLS) newX = COLS - newShape[0].length; 
                
                if (this.isValid(newX, this.y, newShape)) {
                    this.shape = newShape;
                    this.x = newX;
                }
            }

            isValid(x, y, shape) {
                for (let r = 0; r < shape.length; r++) {
                    for (let c = 0; c < shape[r].length; c++) {
                        if (shape[r][c] > 0) {
                            let newX = x + c;
                            let newY = y + r;
                            
                            if (newX < 0 || newX >= COLS || newY >= ROWS) return false;
                            if (newY >= 0 && board[newY][newX] > 0) return false;
                        }
                    }
                }
                return true;
            }

            lock() {
                this.shape.forEach((row, y) => {
                    row.forEach((value, x) => {
                        if (value > 0) {
                            if (this.y + y < 0) {
                                triggerGameOver(); 
                                return;
                            }
                            board[this.y + y][this.x + x] = this.colorIndex;
                        }
                    });
                });
                clearLines();
            }
        }

        function spawnNewPiece() {
            const rand = Math.floor(Math.random() * SHAPES.length);
            const colorIndex = rand + 1; 
            currentPiece = new Piece(SHAPES[rand], colorIndex);

            if (!currentPiece.isValid(currentPiece.x, currentPiece.y, currentPiece.shape)) {
                triggerGameOver();
            }
        }

        function clearLines() {
            let linesCleared = 0;
            for (let y = ROWS - 1; y >= 0; y--) {
                if (board[y].every(cell => cell > 0)) {
                    board.splice(y, 1);
                    board.unshift(Array(COLS).fill(0));
                    linesCleared++;
                    y++; 
                }
            }
            if (linesCleared > 0) {
                score += linesCleared * 100 * linesCleared; 
                scoreEl.innerText = score;

                linesClearedTotal += linesCleared;
                const newLevel = Math.floor(linesClearedTotal / 10) + 1;
                
                if (newLevel > level) {
                    level = newLevel;

                    // â˜…â˜…â˜… NEW: 'ê¸°ê¹”ë‚˜ëŠ”' 30ë‹¨ê³„ 'ì§€ì˜¥ ë‚œì´ë„' 'ê°€ì¦ˆì•„!' â˜…â˜…â˜…
                    if (level > 30) { 
                        triggerGameWin(); // 'ê¸°ê¹”ë‚˜ëŠ”' ìµœê³  ë ˆë²¨ 'ê¸°ê¹”ë‚˜ê²Œ' ë„ë‹¬! 'ê¸°ê¹”ë‚˜ëŠ”' ìŠ¹ë¦¬!
                        return;
                    }
                    
                    // â˜…â˜…â˜… NEW: 'ê¸°ê¹”ë‚˜ëŠ”' 1,000ì› 'í˜ì´íŒ”' 'ì–‘ì‹¬ í˜ì´ì›”' 'ê°€ì¦ˆì•„!' â˜…â˜…â˜…
                    if (level === 10 && !paywallShown) {
                        paywallShown = true;
                        showPaywall();
                        return; // 'ê¸°ê¹”ë‚˜ëŠ”' í˜ì´ì›” 'ê¸°ê¹”ë‚˜ê²Œ' ë„ìš°ê³  'ê¸°ê¹”ë‚˜ê²Œ' ë©ˆì¶¤!
                    }
                    // --- END NEW ---

                    levelEl.innerText = level;
                    // 'ê¸°ê¹”ë‚˜ëŠ”' ì§€ì˜¥ì˜ 'ê¸°ê¹”ë‚˜ëŠ”' ê³µì‹!
                    dropInterval = Math.max(100, 700 - (level - 1) * 50); 
                    
                    showLevelUpModal(level); 
                }
            }
        }

        function drawBoard() {
            ctx.font = `${BLOCK_SIZE * 0.9}px Arial`; 
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            board.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value > 0) { 
                        const emoji = EMOJIS[value];
                        const drawX = x * BLOCK_SIZE + BLOCK_SIZE / 2;
                        const drawY = y * BLOCK_SIZE + BLOCK_SIZE / 2;
                        ctx.fillText(emoji, drawX, drawY);
                    }
                });
            });
        }

        function triggerGameOver() {
            gameOver = true;
            gameOverEl.classList.remove('hidden');
            finalScoreEl.innerText = score;
            bgMusic.pause(); 
        }

        function triggerGameWin() {
            gameOver = true; 
            gameWinEl.classList.remove('hidden');
            winScoreEl.innerText = score; // 'ê¸°ê¹”ë‚˜ëŠ”' ìŠ¹ë¦¬ ì ìˆ˜ 'ê¸°ê¹”ë‚˜ê²Œ' íŒ!
            winLevelEl.innerText = level; // 'ê¸°ê¹”ë‚˜ëŠ”' ìŠ¹ë¦¬ ë ˆë²¨ 'ê¸°ê¹”ë‚˜ê²Œ' íŒ!
            bgMusic.pause(); 
        }

        // â˜…â˜…â˜… NEW: 'ê¸°ê¹”ë‚˜ëŠ”' 1,000ì› 'í˜ì´íŒ”' 'ì–‘ì‹¬ í˜ì´ì›”' 'ê°€ì¦ˆì•„!' â˜…â˜…â˜…
        function showPaywall() {
            gamePaused = true;
            paywallEl.classList.remove('hidden');
        }

        continueButton.addEventListener('click', (e) => {
            e.stopPropagation(); // 'ê¸°ê¹”ë‚˜ëŠ”' ì´ë²¤íŠ¸ 'ê¸°ê¹”ë‚˜ê²Œ' ì‹¹! 'ê¸°ê¹”ë‚˜ê²Œ' ë§‰ê¸°
            paywallEl.classList.add('hidden');
            gamePaused = false;
            // 'ê¸°ê¹”ë‚˜ëŠ”' 10ë ˆë²¨ 'ê¸°ê¹”ë‚˜ëŠ”' ì†ë„ 'ê¸°ê¹”ë‚˜ê²Œ' ì ìš©!
            levelEl.innerText = level;
            dropInterval = Math.max(100, 700 - (level - 1) * 50); 
            showLevelUpModal(level); // 'ê¸°ê¹”ë‚˜ëŠ”' 'Are You Ready?' 'ê¸°ê¹”ë‚˜ê²Œ' ë„ìš°ê¸°
        });
        // --- END NEW ---


        function showLevelUpModal(nextLevel) {
            gamePaused = true; 
            nextLevelEl.innerText = nextLevel;
            levelUpEl.classList.remove('hidden');

            setTimeout(() => {
                levelUpEl.classList.add('hidden');
                gamePaused = false;
                requestAnimationFrame(gameLoop); 
            }, 2000); 
        }

        let lastTime = 0;
        let dropCounter = 0;

        function gameLoop(time = 0) {
            if (gameOver || gamePaused) return; 

            const deltaTime = time - lastTime;
            lastTime = time;
            dropCounter += deltaTime;

            if (dropCounter > dropInterval) {
                currentPiece.move(0, 1); 
                dropCounter = 0;
            }

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBoard();
            currentPiece.draw();

            requestAnimationFrame(gameLoop);
        }

        // 'ê¸°ê¹”ë‚˜ëŠ”' í‚¤ë³´ë“œ 'ê¸°ê¹”ë‚˜ëŠ”' ì¡°ì‘
        document.addEventListener('keydown', (e) => {
            if (gameOver || gamePaused) return; 
            
            if (e.key === 'ArrowLeft' || e.key.toLowerCase() === 'a') {
                currentPiece.move(-1, 0);
            } else if (e.key === 'ArrowRight' || e.key.toLowerCase() === 'd') {
                currentPiece.move(1, 0);
            } else if (e.key === 'ArrowDown' || e.key.toLowerCase() === 's') {
                currentPiece.move(0, 1);
                dropCounter = 0; 
            } else if (e.key === 'ArrowUp' || e.key.toLowerCase() === 'w') {
                currentPiece.rotate();
            }
        });
        
        // 'ê¸°ê¹”ë‚˜ëŠ”' ëª¨ë°”ì¼ 'ê¸°ê¹”ë‚˜ëŠ”' ìŠ¤ì™€ì´í”„ 'ê¸°ê¹”ë‚˜ëŠ”' ì¡°ì‘
        let touchStartX = 0;
        let touchStartY = 0;

        document.body.addEventListener('touchstart', (e) => {
            if (e.target.tagName === 'BUTTON' || e.target.tagName === 'A') {
                touchStartX = 0; 
                return;
            }
            e.preventDefault(); 
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        }, { passive: false }); 

        document.body.addEventListener('touchend', (e) => {
            if (gameOver || gamePaused || touchStartX === 0) {
                touchStartX = 0; 
                return; 
            }

            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;

            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            
            const swipeThreshold = 50; 
            const tapThreshold = 20;   

            if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > swipeThreshold) {
                if (deltaX > 0) {
                    currentPiece.move(1, 0); 
                } else {
                    currentPiece.move(-1, 0); 
                }
            } 
            else if (Math.abs(deltaY) > Math.abs(deltaX) && deltaY > swipeThreshold) {
                currentPiece.move(0, 1); 
                dropCounter = 0; 
            } 
            else if (Math.abs(deltaX) < tapThreshold && Math.abs(deltaY) < tapThreshold) {
                currentPiece.rotate(); 
            }

            touchStartX = 0; 
        });

        // 'ê¸°ê¹”ë‚˜ëŠ”' 4ê³¡ ë¯¹ìŠ¤í…Œì 'ê¸°ê¹”ë‚˜ëŠ”' ì¬ìƒ 'ê°€ì¦ˆì•„!'
        function playSong(index) {
            currentTrackIndex = index % playlist.length; 
            bgMusic.src = playlist[currentTrackIndex];
            bgMusic.currentTime = 0;
            if (!isMuted) {
                bgMusic.play().catch(e => console.error(`'${playlist[currentTrackIndex]}' ì¬ìƒ ì‹¤íŒ¨:`, e));
            }
        }

        function playNextSong() {
            playSong(currentTrackIndex + 1); 
        }
        
        bgMusic.addEventListener('ended', playNextSong); // 'ê¸°ê¹”ë‚˜ëŠ”' í•œ ê³¡ 'ê¸°ê¹”ë‚˜ê²Œ' ëë‚˜ë©´ 'ê¸°ê¹”ë‚˜ëŠ”' ë‹¤ìŒ ê³¡!

        // 'ê¸°ê¹”ë‚˜ëŠ”' ìŒì†Œê±° 'ê°€ì¦ˆì•„!'
        muteButton.addEventListener('click', (e) => {
            e.stopPropagation(); 
            isMuted = !isMuted;
            if (isMuted) {
                bgMusic.pause();
                muteButton.innerText = 'ğŸ”‡';
            } else {
                if (!bgMusic.src) {
                    playSong(0);
                } else {
                    bgMusic.play().catch(e => console.error("ìŒì•… ì¬ìƒ ì‹¤íŒ¨:", e));
                }
                muteButton.innerText = 'ğŸ”Š';
            }
        });

        // 'ê¸°ê¹”ë‚˜ëŠ”' ì¬ì‹œì‘ 'ê°€ì¦ˆì•„!'
        restartButton.addEventListener('click', () => {
            board = Array.from({ length: ROWS }, () => Array(COLS).fill(0));
            score = 0;
            gameOver = false;
            gamePaused = false; 
            dropInterval = 700; 
            level = 1; 
            linesClearedTotal = 0; 
            paywallShown = false; // 'ê¸°ê¹”ë‚˜ëŠ”' í˜ì´ì›” 'ê¸°ê¹”ë‚˜ê²Œ' ë¦¬ì…‹!
            scoreEl.innerText = '0';
            levelEl.innerText = '1'; 
            gameOverEl.classList.add('hidden');
            gameWinEl.classList.add('hidden'); 
            
            if (!isMuted) playSong(0);

            spawnNewPiece();
            gameLoop();
        });

        // 'ê¸°ê¹”ë‚˜ëŠ”' ìŠ¹ë¦¬ í›„ 'ê¸°ê¹”ë‚˜ëŠ”' ì¬ì‹œì‘ 'ê°€ì¦ˆì•„!'
        restartButtonWin.addEventListener('click', () => {
            board = Array.from({ length: ROWS }, () => Array(COLS).fill(0));
            score = 0;
            gameOver = false;
            gamePaused = false;
            dropInterval = 700;
            level = 1;
            linesClearedTotal = 0;
            paywallShown = false; // 'ê¸°ê¹”ë‚˜ëŠ”' í˜ì´ì›” 'ê¸°ê¹”ë‚˜ê²Œ' ë¦¬ì…‹!
            scoreEl.innerText = '0';
            levelEl.innerText = '1';
            gameOverEl.classList.add('hidden');
            gameWinEl.classList.add('hidden');

            if (!isMuted) playSong(0);

            spawnNewPiece();
            gameLoop();
        });

        // 'ê¸°ê¹”ë‚˜ëŠ”' ê²Œì„ 'ê¸°ê¹”ë‚˜ê²Œ' ì‹œì‘ 'ê°€ì¦ˆì•„!'
        spawnNewPiece();
        gameLoop();

        // 'ê¸°ê¹”ë‚˜ëŠ”' ì²« 'ê¸°ê¹”ë‚˜ëŠ”' í´ë¦­ 'ê¸°ê¹”ë‚˜ëŠ”' ìŒì•… 'ê¸°ê¹”ë‚˜ê²Œ' ì¬ìƒ 'ê°€ì¦ˆì•„!'
        function playMusicOnFirstInteraction() {
            if (!isMuted && bgMusic.paused && !gameOver) {
                playSong(0); 
            }
            document.body.removeEventListener('click', playMusicOnFirstInteraction);
            document.body.removeEventListener('touchstart', playMusicOnFirstInteraction);
        }
        
        document.body.addEventListener('click', playMusicOnFirstInteraction);
        document.body.addEventListener('touchstart', playMusicOnFirstInteraction);

        // â˜…â˜…â˜… NEW: 'ê¸°ê¹”ë‚˜ëŠ”' 'ê°€ì§œ' ë¼ì´ë¸Œ í†µê³„ 'ê¸°ê¹”ë‚˜ê²Œ' 1ì´ˆë§ˆë‹¤ 'ê¸°ê¹”ë‚˜ê²Œ' ì‹¹! 'ê¸°ê¹”ë‚˜ê²Œ' 'ì—…ë°ì´íŠ¸' 'ê°€ì¦ˆì•„!' â˜…â˜…â˜…
        setInterval(() => {
            if (!gamePaused && !gameOver) {
                fakeParticipants += Math.floor(Math.random() * 3) + 1; // 'ê¸°ê¹”ë‚˜ê²Œ' 1~3ëª… 'ê¸°ê¹”ë‚˜ê²Œ' ì‹¹! 'ê¸°ê¹”ë‚˜ê²Œ' ì¦ê°€
                fakeAvgScore += Math.floor(Math.random() * 10); // 'ê¸°ê¹”ë‚˜ëŠ”' ì ìˆ˜ë„ 'ê¸°ê¹”ë‚˜ê²Œ' ì‹¹! 'ê¸°ê¹”ë‚˜ê²Œ' ì¦ê°€
                
                participantsEl.innerText = fakeParticipants.toLocaleString(); // 'ê¸°ê¹”ë‚˜ëŠ”' ì½¤ë§ˆ 'ê¸°ê¹”ë‚˜ê²Œ' íŒ!
                avgScoreEl.innerText = fakeAvgScore.toLocaleString(); // 'ê¸°ê¹”ë‚˜ëŠ”' ì½¤ë§ˆ 'ê¸°ê¹”ë‚˜ê²Œ' íŒ!
            }
        }, 1500); // 'ê¸°ê¹”ë‚˜ê²Œ' 1.5ì´ˆë§ˆë‹¤ 'ê¸°ê¹”ë‚˜ê²Œ' ì‹¹!
        // --- END NEW ---
    </script>
</body>
</html>

