<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halloween Specter Tetris</title>
    <!-- Tailwind CSS ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ê¸°ê¹”ë‚˜ëŠ” í• ë¡œìœˆ í°íŠ¸ (Griffy) ë¡œë“œ (ë” ê·€ì—¬ìš´ í°íŠ¸ë¡œ ë³€ê²½!) -->
    <link href="https://fonts.googleapis.com/css2?family=Griffy&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Griffy', cursive; /* í°íŠ¸ ë³€ê²½! */
            overflow: hidden; /* ìŠ¤í¬ë¡¤ ë°©ì§€ */
            background: linear-gradient(180deg, #0d0a1a 0%, #310b4a 100%); /* ì–´ë‘¡ê³  ë³´ë¼ìƒ‰ì¸ ë°°ê²½ */
        }
        canvas {
            background-color: #1a1a1a;
            display: block;
            border: 4px dashed #ff6600; /* í• ë¡œìœˆ ì£¼í™©ìƒ‰ ì ì„  */
            box-shadow: 0 0 25px #ff6600, inset 0 0 10px #000;
        }
        .hidden { display: none; }
        /* ì¼ë°˜ í…ìŠ¤íŠ¸ìš© í°íŠ¸ (ê°€ë…ì„±) */
        .normal-text {
            font-family: 'Inter', sans-serif; /* Tailwind ê¸°ë³¸ í°íŠ¸ */
        }
    </style>
</head>
<body class="text-white min-h-screen flex flex-col items-center justify-center p-4">

    <div class="w-full max-w-sm text-center">
        <h1 class="text-5xl font-bold text-orange-500 mb-2">Halloween Specters</h1>
        <!-- ë¶€ì œ ìœ„ì¹˜ë¥¼ ìº”ë²„ìŠ¤ ì•„ë˜ë¡œ ì´ë™! -->
        <!-- <p class="text-2xl text-purple-300 mb-4">"ë³´ë¦„ë‹¬ì´ ëœ¨ë©´ ê·¸ë“¤ì´ ì˜¨ë‹¤! ë„ì „í•´ë³¼ë˜?" ğŸŒ•</p> -->

        <div class="flex justify-between text-3xl mb-2 text-lime-400">
            <span>Score: <span id="score">0</span></span>
            <!-- NEW: ë ˆë²¨(ë‹¨ê³„) í‘œì‹œ -->
            <span>Level: <span id="level">1</span></span>
        </div>

        <!-- ê²Œì„ ìº”ë²„ìŠ¤ -->
        <canvas id="gameCanvas" width="300" height="600" class="rounded-lg"></canvas>

        <!-- NEW: ë¶€ì œ ìœ„ì¹˜ ì´ë™! (ìº”ë²„ìŠ¤ ë°”ë¡œ ì•„ë˜) -->
        <p class="text-2xl text-purple-300 mt-4">"ë³´ë¦„ë‹¬ì´ ëœ¨ë©´ ê·¸ë“¤ì´ ì˜¨ë‹¤! ë„ì „í•´ë³¼ë˜?" ğŸŒ•</p>

        <!-- NEW: Janesays í™ë³´! 'ê¸°ê¹”ë‚˜ê²Œ' ê°‘ì‹œë‹¤! -->
        <div class="mt-4 text-lime-400 text-xl">
            Created by <a href="https://www.youtube.com/@JANESayS" target="_blank" class="hover:text-orange-500 underline">JANESayS</a>
            <p class="text-sm normal-text text-gray-400">(Click to listen to the original soundtrack!)</p>
        </div>

        <!-- ê²Œì„ ì˜¤ë²„ ë©”ì‹œì§€ -->
        <div id="game-over" class="hidden absolute inset-0 bg-black bg-opacity-80 flex flex-col justify-center items-center">
            <h2 class="text-7xl font-bold text-red-600">GAME OVER</h2>
            <p class="text-4xl mt-4">Score: <span id="finalScore">0</span></p>
            <button id="restartButton" class="mt-8 px-8 py-4 bg-orange-500 text-gray-900 font-bold rounded-lg shadow-lg hover:bg-orange-400 transition-all text-4xl">
                Restart
            </button>
        </div>

        <!-- NEW: ë ˆë²¨ ì—…! "Are You Ready?" ëª¨ë‹¬ -->
        <div id="level-up" class="hidden absolute inset-0 bg-black bg-opacity-80 flex flex-col justify-center items-center text-center p-4">
            <div class="text-8xl mb-4">ğŸ’€</div> <!-- í˜¸ë°• ğŸƒì´ë‚˜ í•´ê³¨ ğŸ’€ -->
            <h2 class="text-6xl font-bold text-lime-400">LEVEL <span id="nextLevel">2</span></h2>
            <p class="text-5xl mt-4 text-white">Are You Ready?</p>
        </div>

        <!-- NEW: ë ˆë²¨ 20 ê²©íŒŒ! 'ê¸°ê¹”ë‚˜ëŠ”' ì—”ë”©! -->
        <div id="game-win" class="hidden absolute inset-0 bg-black bg-opacity-80 flex flex-col justify-center items-center text-center p-4">
            <div class="text-9xl mb-4">ğŸ‡°ğŸ‡·ğŸ’€</div> <!-- í•œë³µ ìŠ¤ì¼ˆë ˆí†¤ (ì„ì‹œ ì´ëª¨ì§€) -->
            <h2 class="text-6xl font-bold text-orange-500">YOU WIN!</h2>
            <p class="text-4xl mt-4 text-lime-400">"ìŠ¤ì¼ˆë ˆíƒˆì˜ ì„¸ë ˆë‚˜ë°ë¥¼ ë¶€ë¥´ëŠ” ì¤‘..." ğŸ¶</p>
            <button id="restartButtonWin" class="mt-8 px-8 py-4 bg-orange-500 text-gray-900 font-bold rounded-lg shadow-lg hover:bg-orange-400 transition-all text-4xl">
                Play Again?
            </button>
        </div>
    </div>
    
    <!-- TODO: JANESAYSë‹˜ì˜ 'í• ë¡œìœˆ ë…¸ë˜' ë°°ê²½ìŒì•…ìœ¼ë¡œ ë„£ê¸°! -->
    <!-- <audio id="bgMusic" src="YOUR_HALLOWEEN_SONG.mp3" loop></audio> -->

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // UI ìš”ì†Œ
        const scoreEl = document.getElementById('score');
        const levelEl = document.getElementById('level'); // NEW: ë ˆë²¨ UI
        const gameOverEl = document.getElementById('game-over');
        const finalScoreEl = document.getElementById('finalScore');
        const restartButton = document.getElementById('restartButton');
        // --- NEW: ì‹ ê·œ UI ìš”ì†Œ ---
        const levelUpEl = document.getElementById('level-up');
        const nextLevelEl = document.getElementById('nextLevel');
        const gameWinEl = document.getElementById('game-win');
        const restartButtonWin = document.getElementById('restartButtonWin');
        // --- END NEW ---

        // ê²Œì„ ë³´ë“œ ì„¤ì •
        const COLS = 10;
        const ROWS = 20;
        const BLOCK_SIZE = 30; // 300 / 10

        let board = Array.from({ length: ROWS }, () => Array(COLS).fill(0));
        let score = 0;
        let gameOver = false;
        let gamePaused = false; // NEW: ê²Œì„ ì¼ì‹œì •ì§€ (ë ˆë²¨ ì—… ëª¨ë‹¬ìš©)
        let dropInterval = 700; // 0.7ì´ˆë¡œ ì†ë„ UP! (ì´ì œ ë ˆë²¨ì— ë”°ë¼ ë°”ë€œ)
        let level = 1; // NEW: ë ˆë²¨ ë³€ìˆ˜
        let linesClearedTotal = 0; // NEW: ë ˆë²¨ì—…ì„ ìœ„í•œ ì´ ë¼ì¸ ìˆ˜

        // ëª¬ìŠ¤í„° ë¸”ë¡ (Tetrominoes)
        const SHAPES = [
            [[1, 1, 1, 1]], // I (Wolfman ğŸº)
            [[1, 1], [1, 1]], // O (Pumpkin ğŸƒ)
            [[0, 1, 0], [1, 1, 1]], // T (Skeletal ğŸ’€)
            [[1, 0, 0], [1, 1, 1]], // J (Siren ğŸ§œ)
            [[0, 0, 1], [1, 1, 1]], // L (Vampire ğŸ§›)
            [[1, 1, 0], [0, 1, 1]], // S (Zombie ğŸ§Ÿ)
            [[0, 1, 1], [1, 1, 0]]  // Z (Ghost ğŸ‘»)
        ];

        // ê¸°ê¹”ë‚˜ëŠ” ëª¬ìŠ¤í„° ìƒ‰ìƒ (-> ì´ëª¨ì§€ë¡œ ëŒ€ì²´!)
        const EMOJIS = [
            null, // 0ì€ ë¹ˆ ì¹¸
            'ğŸº', // 1: Wolfman
            'ğŸƒ', // 2: Pumpkin
            'ğŸ’€', // 3: Skeletal
            'ğŸ§œ', // 4: Siren
            'ğŸ§›', // 5: Vampire
            'ğŸ§Ÿ', // 6: Zombie
            'ğŸ‘»'  // 7: Ghost
        ];
        
        let currentPiece;

        class Piece {
            constructor(shape, colorIndex) {
                this.shape = shape;
                // this.color = COLORS[colorIndex]; // ì´ëª¨ì§€ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ìƒ‰ìƒ ì œê±°
                this.colorIndex = colorIndex; // ë³´ë“œì— ì €ì¥í•  ê°’
                this.x = Math.floor(COLS / 2) - Math.floor(this.shape[0].length / 2);
                this.y = 0;
            }

            draw() {
                // ctx.fillStyle = this.color; // ì´ëª¨ì§€ë¡œ ëŒ€ì²´
                // ctx.shadowColor = this.color; // ì´ëª¨ì§€ë¡œ ëŒ€ì²´
                // ctx.shadowBlur = 10; // ì´ëª¨ì§€ë¡œ ëŒ€ì²´
                ctx.font = `${BLOCK_SIZE * 0.9}px Arial`; // ì´ëª¨ì§€ í°íŠ¸ í¬ê¸°
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                const emoji = EMOJIS[this.colorIndex];

                this.shape.forEach((row, y) => {
                    row.forEach((value, x) => {
                        if (value > 0) {
                            // ctx.fillRect((this.x + x) * BLOCK_SIZE, (this.y + y) * BLOCK_SIZE, BLOCK_SIZE - 1, BLOCK_SIZE - 1); // ì‚¬ê°í˜• ëŒ€ì‹  í…ìŠ¤íŠ¸(ì´ëª¨ì§€)
                            const drawX = (this.x + x) * BLOCK_SIZE + BLOCK_SIZE / 2;
                            const drawY = (this.y + y) * BLOCK_SIZE + BLOCK_SIZE / 2;
                            ctx.fillText(emoji, drawX, drawY);
                        }
                    });
                });
                // ctx.shadowBlur = 0; // ì´ëª¨ì§€ë¡œ ëŒ€ì²´
            }

            move(dx, dy) {
                if (!this.isValid(this.x + dx, this.y + dy, this.shape)) {
                    if (dy === 1) { // ì•„ë˜ë¡œ ì´ë™ ì¤‘ ì¶©ëŒ
                        this.lock();
                        spawnNewPiece();
                    }
                    return; // ì´ë™ ë¶ˆê°€
                }
                this.x += dx;
                this.y += dy;
            }

            rotate() {
                const newShape = [];
                // 90ë„ ì‹œê³„ë°©í–¥ íšŒì „
                for (let y = 0; y < this.shape[0].length; y++) {
                    newShape[y] = [];
                    for (let x = 0; x < this.shape.length; x++) {
                        newShape[y][x] = this.shape[this.shape.length - 1 - x][y];
                    }
                }

                // íšŒì „ ì‹œ ë²½/ë°”ë‹¥ ì¶©ëŒ ë³´ì •
                let newX = this.x;
                if (newX < 0) newX = 0; // ì™¼ìª½ ë²½
                if (newX + newShape[0].length > COLS) newX = COLS - newShape[0].length; // ì˜¤ë¥¸ìª½ ë²½
                
                if (this.isValid(newX, this.y, newShape)) {
                    this.shape = newShape;
                    this.x = newX;
                }
            }

            isValid(x, y, shape) {
                for (let r = 0; r < shape.length; r++) {
                    for (let c = 0; c < shape[r].length; c++) {
                        if (shape[r][c] > 0) {
                            let newX = x + c;
                            let newY = y + r;
                            
                            // ë²½ ì¶©ëŒ
                            if (newX < 0 || newX >= COLS || newY >= ROWS) return false;
                            // ë°”ë‹¥ì´ë‚˜ ë‹¤ë¥¸ ë¸”ë¡ ì¶©ëŒ
                            if (newY >= 0 && board[newY][newX] > 0) return false;
                        }
                    }
                }
                return true;
            }

            lock() {
                this.shape.forEach((row, y) => {
                    row.forEach((value, x) => {
                        if (value > 0) {
                            if (this.y + y < 0) {
                                triggerGameOver(); // ë§¨ ìœ„ì— ë‹¿ìœ¼ë©´ ê²Œì„ ì˜¤ë²„
                                return;
                            }
                            board[this.y + y][this.x + x] = this.colorIndex;
                        }
                    });
                });
                clearLines();
            }
        }

        function spawnNewPiece() {
            const rand = Math.floor(Math.random() * SHAPES.length);
            const colorIndex = rand + 1; // 1~7
            currentPiece = new Piece(SHAPES[rand], colorIndex);

            if (!currentPiece.isValid(currentPiece.x, currentPiece.y, currentPiece.shape)) {
                triggerGameOver();
            }
        }

        function clearLines() {
            let linesCleared = 0;
            for (let y = ROWS - 1; y >= 0; y--) {
                if (board[y].every(cell => cell > 0)) {
                    // ì¤„ ì‚­ì œ ë° ë§¨ ìœ„ì— ìƒˆ ì¤„ ì¶”ê°€
                    board.splice(y, 1);
                    board.unshift(Array(COLS).fill(0));
                    linesCleared++;
                    y++; // ì‚­ì œí–ˆìœ¼ë‹ˆ ê°™ì€ ì¤„ ë‹¤ì‹œ ê²€ì‚¬
                }
            }
            // ì ìˆ˜ ê³„ì‚° (ê¸°ê¹”ë‚˜ê²Œ!)
            if (linesCleared > 0) {
                score += linesCleared * 100 * linesCleared; // 1ì¤„=100, 2ì¤„=400, 3ì¤„=900, 4ì¤„(í…íŠ¸ë¦¬ìŠ¤!)=1600
                scoreEl.innerText = score;

                // --- NEW: 'ë¯¸ì¹œë“¯í•œ' ë‚œì´ë„(ë ˆë²¨) ì¡°ì ˆ ì‹œìŠ¤í…œ ---
                linesClearedTotal += linesCleared;
                const newLevel = Math.floor(linesClearedTotal / 10) + 1;
                
                if (newLevel > level) {
                    level = newLevel;

                    // --- NEW: ë ˆë²¨ 20 ê²©íŒŒ (Level 21 ë„ë‹¬) ---
                    if (level > 20) { 
                        triggerGameWin();
                        return; // ê²Œì„ ìŠ¹ë¦¬, ë£¨í”„ ì¤‘ë‹¨
                    }
                    // --- END NEW ---

                    levelEl.innerText = level;
                    // ë ˆë²¨ë‹¹ 50msì”© ì†ë„ ì¦ê°€, ìµœì†Œ 100ms(0.1ì´ˆ)
                    dropInterval = Math.max(100, 700 - (level - 1) * 50); 
                    
                    // --- NEW: "Are You Ready?" ëª¨ë‹¬ ë„ìš°ê¸° ---
                    showLevelUpModal(level); 
                }
                // --- END NEW ---
            }
        }

        function drawBoard() {
            ctx.font = `${BLOCK_SIZE * 0.9}px Arial`; // ì´ëª¨ì§€ í°íŠ¸ í¬ê¸°
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            board.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value > 0) { // ë³´ë“œì— êµ³ì–´ì§„ ë¸”ë¡
                        // ctx.fillStyle = COLORS[value]; // ì´ëª¨ì§€ë¡œ ëŒ€ì²´
                        // ctx.shadowColor = COLORS[value]; // ì´ëª¨ì§€ë¡œ ëŒ€ì²´
                        // ctx.shadowBlur = 5; // ì´ëª¨ì§€ë¡œ ëŒ€ì²´
                        // ctx.fillRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE - 1, BLOCK_SIZE - 1); // ì‚¬ê°í˜• ëŒ€ì‹  í…ìŠ¤íŠ¸(ì´ëª¨ì§€)
                        
                        const emoji = EMOJIS[value];
                        const drawX = x * BLOCK_SIZE + BLOCK_SIZE / 2;
                        const drawY = y * BLOCK_SIZE + BLOCK_SIZE / 2;
                        ctx.fillText(emoji, drawX, drawY);
                    }
                });
            });
            // ctx.shadowBlur = 0; // ì´ëª¨ì§€ë¡œ ëŒ€ì²´
        }

        function triggerGameOver() {
            gameOver = true;
            gameOverEl.classList.remove('hidden');
            finalScoreEl.innerText = score;
        }

        // --- NEW: ë ˆë²¨ 20 ê²©íŒŒ! ---
        function triggerGameWin() {
            gameOver = true; // ê²Œì„ ë£¨í”„ë¥¼ ë©ˆì¶”ê¸° ìœ„í•´
            gameWinEl.classList.remove('hidden');
            // TODO: ì—¬ê¸°ì— 'ìŠ¤ì¼ˆë ˆíƒˆì˜ ì„¸ë ˆë‚˜ë°' ì¬ìƒ ì½”ë“œ!
        }

        // --- NEW: "Are You Ready?" ëª¨ë‹¬ ---
        function showLevelUpModal(nextLevel) {
            gamePaused = true; // ê²Œì„ ì¼ì‹œì •ì§€
            nextLevelEl.innerText = nextLevel;
            levelUpEl.classList.remove('hidden');

            // 2ì´ˆ í›„ì— ëª¨ë‹¬ ìˆ¨ê¸°ê³  ê²Œì„ ì¬ê°œ
            setTimeout(() => {
                levelUpEl.classList.add('hidden');
                gamePaused = false;
                requestAnimationFrame(gameLoop); // ì¼ì‹œì •ì§€ í›„ ë£¨í”„ ì¬ì‹œì‘
            }, 2000); // 2ì´ˆê°„ ë³´ì—¬ì£¼ê¸°
        }

        // ê²Œì„ ë£¨í”„
        let lastTime = 0;
        let dropCounter = 0;
        // let dropInterval = 700; // (ì „ì—­ ë³€ìˆ˜ë¡œ ì´ë™)

        function gameLoop(time = 0) {
            if (gameOver || gamePaused) return; // NEW: ì¼ì‹œì •ì§€ ì²´í¬

            const deltaTime = time - lastTime;
            lastTime = time;
            dropCounter += deltaTime;

            if (dropCounter > dropInterval) {
                currentPiece.move(0, 1); // 1ì¹¸ ì•„ë˜ë¡œ
                dropCounter = 0;
            }

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBoard();
            currentPiece.draw();

            requestAnimationFrame(gameLoop);
        }

        // ì¡°ì‘ (í‚¤ë³´ë“œ)
        document.addEventListener('keydown', (e) => {
            if (gameOver || gamePaused) return; // NEW: ì¼ì‹œì •ì§€ ì²´í¬
            
            if (e.key === 'ArrowLeft' || e.key.toLowerCase() === 'a') {
                currentPiece.move(-1, 0);
            } else if (e.key === 'ArrowRight' || e.key.toLowerCase() === 'd') {
                currentPiece.move(1, 0);
            } else if (e.key === 'ArrowDown' || e.key.toLowerCase() === 's') {
                currentPiece.move(0, 1);
                dropCounter = 0; // ìˆ˜ë™ìœ¼ë¡œ ë‚´ë¦¬ë©´ íƒ€ì´ë¨¸ ë¦¬ì…‹
            } else if (e.key === 'ArrowUp' || e.key.toLowerCase() === 'w') {
                currentPiece.rotate();
            }
        });
        
        // TODO: ëª¨ë°”ì¼ í„°ì¹˜ ì¡°ì‘ (ìŠ¤ì™€ì´í”„, íƒ­) ì¶”ê°€

        // ê²Œì„ ì¬ì‹œì‘
        restartButton.addEventListener('click', () => {
            board = Array.from({ length: ROWS }, () => Array(COLS).fill(0));
            score = 0;
            gameOver = false;
            gamePaused = false; // --- NEW: ë¦¬ì…‹ ---
            dropInterval = 700; // --- NEW: ì†ë„ ë¦¬ì…‹ ---
            level = 1; // --- NEW: ë ˆë²¨ ë¦¬ì…‹ ---
            linesClearedTotal = 0; // --- NEW: ì´ ë¼ì¸ ë¦¬ì…‹ ---
            scoreEl.innerText = '0';
            levelEl.innerText = '1'; // --- NEW: ë ˆë²¨ UI ë¦¬ì…‹ ---
            gameOverEl.classList.add('hidden');
            gameWinEl.classList.add('hidden'); // --- NEW: ìŠ¹ë¦¬ í™”ë©´ ìˆ¨ê¸°ê¸° ---
            spawnNewPiece();
            gameLoop();
        });

        // --- NEW: ìŠ¹ë¦¬ í™”ë©´ì—ì„œì˜ ì¬ì‹œì‘ ---
        restartButtonWin.addEventListener('click', () => {
            board = Array.from({ length: ROWS }, () => Array(COLS).fill(0));
            score = 0;
            gameOver = false;
            gamePaused = false;
            dropInterval = 700;
            level = 1;
            linesClearedTotal = 0;
            scoreEl.innerText = '0';
            levelEl.innerText = '1';
            gameOverEl.classList.add('hidden');
            gameWinEl.classList.add('hidden');
            spawnNewPiece();
            gameLoop();
        });

        // ê²Œì„ ì‹œì‘
        spawnNewPiece();
        gameLoop();
    </script>
</body>
</html>






